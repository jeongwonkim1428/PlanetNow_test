<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.application.planetnow.user.UserDAO">




    <select id="validEmailResult" parameterType="String" resultType="String">
        SELECT EMAIL
        FROM USER
        WHERE EMAIL = #{email}


    </select>
    <select id="validNicknameResult" parameterType="String" resultType="String">
        SELECT NICKNAME
        FROM USER
        WHERE NICKNAME = #{nickname}


    </select>


    <insert id="saveUser" parameterType="userDTO">
        INSERT INTO USER(NAME,
                         EMAIL,
                         NICKNAME,
                         PASSWORD,
                         BIRTH_TIMESTAMP,
                         SEX,
                         PHONE_NUMBER,
                         ZIPCODE,
                         ROAD_ADDRESS,
                         JIBUN_ADDRESS,
                         ETC_ADDRESS,
                         PROFILE_ORIGINAL_NAME,
                         PROFILE_UUID,
                         AMBITION_QUOTE,
                         LEVEl_ID,
                         TOTAL_POINT,
                         ENROLLED_AT,
                         MODIFIED_AT,
                         ROLE
        )
        VALUES(#{name},
               #{email},
               #{nickname},
               #{password},
               #{birthTimestamp},
               #{sex},
               #{phoneNumber},
               #{zipcode},
               #{roadAddress},
               #{jibunAddress},
               #{etcAddress},
               #{profileOriginalName},
               #{profileUuid},
               #{ambitionQuote},
               #{levelId},
               #{totalPoint},
               NOW(),
               NOW(),
               #{role}




              )


    </insert>
    <select id="loginResult" parameterType="UserDTO" resultType="UserDTO">
        SELECT *
        FROM USER
        WHERE EMAIL =#{email}

    </select>


    <update id="updateUser" parameterType="UserDTO">
        UPDATE USER
        SET
            NAME = #{name},
            EMAIL = #{email},
            NICKNAME = #{nickname},
            PASSWORD = #{password},
            BIRTH_TIMESTAMP = #{birthTimestamp},
            SEX = #{sex},
            PHONE_NUMBER = #{phoneNumber},
            ZIPCODE = #{zipcode},
            ROAD_ADDRESS = #{roadAddress},
            JIBUN_ADDRESS = #{jibunAddress},
            ETC_ADDRESS = #{etcAddress},
            PROFILE_ORIGINAL_NAME = #{profileOriginalName},
            PROFILE_UUID = #{profileUuid},
            AMBITION_QUOTE = #{ambitionQuote},
            LEVEL_ID = #{levelId},
            TOTAL_POINT = #{totalPoint},
            ENROLLED_AT = #{enrolledAt},
            MODIFIED_AT = #{modifiedAt},
            ROLE = #{role}
        WHERE USER_ID = #{userId}
    </update>
    <select id="getUserDetail" parameterType="String">
        SELECT *
        FROM USER
        WHERE EMAIL=#{email}
    </select>
    <select id="getUserDetailById" parameterType="Long">
        SELECT *
        FROM USER
        WHERE USER_ID=#{userId}
    </select>
    <delete id="removeUserResult" parameterType="String">
        DELETE FROM USER
        WHERE EMAIL=#{email}
    </delete>
    <update id="update" parameterType="UserDTO">
        UPDATE USER
        SET NICKNAME =#{nickname},
        PHONE_NUMBER = #{phoneNumber},
        ZIPCODE = #{zipcode},
        ROAD_ADDRESS = #{roadAddress},
        JIBUN_ADDRESS = #{jibunAddress},
        ETC_ADDRESS = #{etcAddress},
        PROFILE_ORIGINAL_NAME = #{profileOriginalName},
        PROFILE_UUID = #{profileUuid},
        AMBITION_QUOTE = #{ambitionQuote},
        MODIFIED_AT=NOW()
        <if test="password != null and password != ''">
            , PASSWORD = #{password}
        </if>
        WHERE USER_ID=#{userId}




    </update>
    <select id="searchUser" parameterType="String" resultType="UserDTO">
        SELECT *
        FROM USER
        WHERE NAME LIKE  CONCAT(#{input}, '%') OR NICKNAME LIKE CONCAT(#{input}, '%')


    </select>




</mapper>

